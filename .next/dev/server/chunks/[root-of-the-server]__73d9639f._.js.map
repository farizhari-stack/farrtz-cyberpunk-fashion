{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/DownloadChrome/copy-of-farrtz-cyberpunk-fashion-next-update-cap-2/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///D:/DownloadChrome/copy-of-farrtz-cyberpunk-fashion-next-update-cap-2/app/api/messages/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { supabase } from '@/lib/supabase';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const { data: conversations, error } = await supabase\r\n            .from('chat_conversations')\r\n            .select(`\r\n                *,\r\n                messages:chat_messages(*)\r\n            `);\r\n\r\n        if (error) throw error;\r\n\r\n        // Formatted map for frontend\r\n        const formatted = conversations.map(c => ({\r\n            userId: c.user_id,\r\n            userName: c.user_name,\r\n            userEmail: c.user_email,\r\n            lastMessageTime: c.last_message_time,\r\n            unreadCount: c.unread_count,\r\n            messages: c.messages.map((m: any) => ({\r\n                id: m.id,\r\n                conversationId: m.conversation_id,\r\n                userId: m.user_id,\r\n                userName: m.user_name,\r\n                message: m.message,\r\n                sender: m.sender,\r\n                timestamp: m.timestamp,\r\n                read: m.read\r\n            }))\r\n        }));\r\n\r\n        return NextResponse.json(formatted);\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Error fetching messages' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const json = await request.json();\r\n\r\n        // 1. Check if conversation exists\r\n        const { data: existingConv } = await supabase\r\n            .from('chat_conversations')\r\n            .select('*')\r\n            .eq('user_id', json.userId)\r\n            .single();\r\n\r\n        let conversationId = json.userId;\r\n\r\n        // 2. Create or Update Conversation\r\n        if (!existingConv) {\r\n            await supabase.from('chat_conversations').insert({\r\n                user_id: json.userId,\r\n                user_name: json.userName || 'User',\r\n                user_email: '', // Optional or fetch from user table\r\n                unread_count: json.sender === 'user' ? 1 : 0,\r\n                last_message_time: new Date().toISOString()\r\n            });\r\n        } else {\r\n            // Update unread count and time\r\n            await supabase.from('chat_conversations')\r\n                .update({\r\n                    unread_count: json.sender === 'user' ? (existingConv.unread_count + 1) : 0,\r\n                    last_message_time: new Date().toISOString()\r\n                })\r\n                .eq('user_id', json.userId);\r\n        }\r\n\r\n        // 3. Insert Message\r\n        const { data: message, error } = await supabase\r\n            .from('chat_messages')\r\n            .insert({\r\n                conversation_id: conversationId,\r\n                user_id: json.userId,\r\n                user_name: json.userName || existingConv?.user_name || 'User',\r\n                message: json.message,\r\n                sender: json.sender,\r\n                read: json.sender === 'admin'\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({\r\n            ...message,\r\n            userId: message.user_id,\r\n            conversationId: message.conversation_id,\r\n            userName: message.user_name\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        return NextResponse.json({ error: 'Error sending message' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,EAAE,MAAM,aAAa,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CAChD,IAAI,CAAC,sBACL,MAAM,CAAC,CAAC;;;YAGT,CAAC;QAEL,IAAI,OAAO,MAAM;QAEjB,6BAA6B;QAC7B,MAAM,YAAY,cAAc,GAAG,CAAC,CAAA,IAAK,CAAC;gBACtC,QAAQ,EAAE,OAAO;gBACjB,UAAU,EAAE,SAAS;gBACrB,WAAW,EAAE,UAAU;gBACvB,iBAAiB,EAAE,iBAAiB;gBACpC,aAAa,EAAE,YAAY;gBAC3B,UAAU,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;wBAClC,IAAI,EAAE,EAAE;wBACR,gBAAgB,EAAE,eAAe;wBACjC,QAAQ,EAAE,OAAO;wBACjB,UAAU,EAAE,SAAS;wBACrB,SAAS,EAAE,OAAO;wBAClB,QAAQ,EAAE,MAAM;wBAChB,WAAW,EAAE,SAAS;wBACtB,MAAM,EAAE,IAAI;oBAChB,CAAC;YACL,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACJ;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,kCAAkC;QAClC,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,6HAAQ,CACxC,IAAI,CAAC,sBACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,KAAK,MAAM,EACzB,MAAM;QAEX,IAAI,iBAAiB,KAAK,MAAM;QAEhC,mCAAmC;QACnC,IAAI,CAAC,cAAc;YACf,MAAM,6HAAQ,CAAC,IAAI,CAAC,sBAAsB,MAAM,CAAC;gBAC7C,SAAS,KAAK,MAAM;gBACpB,WAAW,KAAK,QAAQ,IAAI;gBAC5B,YAAY;gBACZ,cAAc,KAAK,MAAM,KAAK,SAAS,IAAI;gBAC3C,mBAAmB,IAAI,OAAO,WAAW;YAC7C;QACJ,OAAO;YACH,+BAA+B;YAC/B,MAAM,6HAAQ,CAAC,IAAI,CAAC,sBACf,MAAM,CAAC;gBACJ,cAAc,KAAK,MAAM,KAAK,SAAU,aAAa,YAAY,GAAG,IAAK;gBACzE,mBAAmB,IAAI,OAAO,WAAW;YAC7C,GACC,EAAE,CAAC,WAAW,KAAK,MAAM;QAClC;QAEA,oBAAoB;QACpB,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CAC1C,IAAI,CAAC,iBACL,MAAM,CAAC;YACJ,iBAAiB;YACjB,SAAS,KAAK,MAAM;YACpB,WAAW,KAAK,QAAQ,IAAI,cAAc,aAAa;YACvD,SAAS,KAAK,OAAO;YACrB,QAAQ,KAAK,MAAM;YACnB,MAAM,KAAK,MAAM,KAAK;QAC1B,GACC,MAAM,GACN,MAAM;QAEX,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,GAAG,OAAO;YACV,QAAQ,QAAQ,OAAO;YACvB,gBAAgB,QAAQ,eAAe;YACvC,UAAU,QAAQ,SAAS;QAC/B;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}