// This is your Prisma schema file for FARRTZ E-commerce
// Learn more at: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== USER ====================
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  avatar    String?
  address   String?
  isAdmin   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  wishlist  Wishlist[]
  orders    Order[]
  couponsCreated Coupon[]   @relation("CouponCreator")
  couponsUsed    CouponUsage[]
  messages  Message[]
  feedback  Feedback[]

  @@map("users")
}

// ==================== WISHLIST ====================
model Wishlist {
  id        String   @id @default(cuid())
  userId    String
  productId Int
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlists")
}

// ==================== PRODUCT ====================
model Product {
  id                 Int      @id @default(autoincrement())
  title              String
  price              Int      // Price in IDR (no decimals needed)
  originalPrice      Int?
  discountPercentage Int?
  discountEndTime    DateTime?
  imageUrl           String?
  category           String
  description        String?
  isNew              Boolean  @default(false)
  isSale             Boolean  @default(false)
  stock              Int      @default(100)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@map("products")
}

// ==================== ORDER ====================
model Order {
  id              String      @id @default(cuid())
  userId          String
  items           Json        // Store cart items as JSON
  shippingDetails Json        // Store shipping info as JSON
  totalAmount     Int
  status          OrderStatus @default(PENDING)
  paymentMethod   PaymentMethod
  paymentProofUrl String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id])

  @@map("orders")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PAID
  PACKING
  SHIPPED
  DELIVERED
}

enum PaymentMethod {
  BANK
  COD
}

// ==================== COUPON ====================
model Coupon {
  id              String   @id @default(cuid())
  code            String   @unique
  discountPercent Int
  expiryDate      DateTime?
  isActive        Boolean  @default(true)
  usageCount      Int      @default(0)
  maxUsage        Int?
  createdById     String
  createdAt       DateTime @default(now())

  createdBy       User     @relation("CouponCreator", fields: [createdById], references: [id])
  usedBy          CouponUsage[]

  @@map("coupons")
}

model CouponUsage {
  id        String   @id @default(cuid())
  couponId  String
  userId    String
  usedAt    DateTime @default(now())

  coupon    Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([couponId, userId])
  @@map("coupon_usages")
}

// ==================== CHAT MESSAGE ====================
model Message {
  id        String   @id @default(cuid())
  userId    String
  userName  String
  message   String
  sender    MessageSender
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("messages")
}

enum MessageSender {
  USER
  ADMIN
}

// ==================== FEEDBACK ====================
model Feedback {
  id        String         @id @default(cuid())
  userId    String
  userName  String
  userEmail String
  rating    Int            // 1-5 stars
  message   String
  type      FeedbackType
  photoUrl  String?
  orderId   String?
  status    FeedbackStatus @default(PENDING)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("feedbacks")
}

enum FeedbackType {
  FEEDBACK
  COMPLAINT
}

enum FeedbackStatus {
  PENDING
  REVIEWED
  RESOLVED
}
